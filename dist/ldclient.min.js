!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.LDClient={})}(this,function(e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function t(e){function n(e,n){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=n}return(n.prototype=new Error).name=e,n.prototype.constructor=n}var S=t("LaunchDarklyUnexpectedResponseError"),fe=t("LaunchDarklyInvalidEnvironmentIdError"),a=t("LaunchDarklyInvalidUserError"),ve=t("LaunchDarklyInvalidEventKeyError"),f=t("LaunchDarklyInvalidArgumentError"),de=t("LaunchDarklyFlagFetchError");function P(e){return!(400<=e&&e<500)||(400===e||408===e||429===e)}for(var s=Object.freeze({LDUnexpectedResponseError:S,LDInvalidEnvironmentIdError:fe,LDInvalidUserError:a,LDInvalidEventKeyError:ve,LDInvalidArgumentError:f,LDFlagFetchError:de,isHttpErrorRecoverable:P}),r=function(e){for(var n,t=e.length,r=t%3,o=[],i=0,a=t-r;i<a;i+=16383)o.push(v(e,i,a<i+16383?a:i+16383));1==r?(n=e[t-1],o.push(u[n>>2]+u[n<<4&63]+"==")):2==r&&(n=(e[t-2]<<8)+e[t-1],o.push(u[n>>10]+u[n>>4&63]+u[n<<2&63]+"="));return o.join("")},u=[],o=[],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,l=i.length;c<l;++c)u[c]=i[c],o[i.charCodeAt(c)]=c;function v(e,n,t){for(var r,o,i=[],a=n;a<t;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(u[(o=r)>>18&63]+u[o>>12&63]+u[o>>6&63]+u[63&o]);return i.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63;var d="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},g=Array.isArray,m=Object.keys,p=Object.prototype.hasOwnProperty,h=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==(void 0===n?"undefined":d(n))&&"object"==(void 0===t?"undefined":d(t))){var r,o,i,a=g(n),u=g(t);if(a&&u){if((o=n.length)!=t.length)return!1;for(r=o;0!=r--;)if(!e(n[r],t[r]))return!1;return!0}if(a!=u)return!1;var s=n instanceof Date,c=t instanceof Date;if(s!=c)return!1;if(s&&c)return n.getTime()==t.getTime();var l=n instanceof RegExp,f=t instanceof RegExp;if(l!=f)return!1;if(l&&f)return n.toString()==t.toString();var v=m(n);if((o=v.length)!==m(t).length)return!1;for(r=o;0!=r--;)if(!p.call(t,v[r]))return!1;for(r=o;0!=r--;)if(!e(n[i=v[r]],t[i]))return!1;return!0}return n!=n&&t!=t},y=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},w=["key","secondary","ip","country","email","firstName","lastName","avatar","name"];function b(e){var n=unescape(encodeURIComponent(e));return r(function(e){for(var n=[],t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}(n))}function ge(e){return b(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function me(e){return JSON.parse(JSON.stringify(e))}function pe(e,n){return h(e,n)}function he(e){setTimeout(e,0)}function ye(e,n){var t=e.then(function(e){return n&&setTimeout(function(){n(null,e)},0),e},function(e){if(!n)return Promise.reject(e);setTimeout(function(){n(e,null)},0)});return n?void 0:t}function k(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]={value:e[t],version:0});return n}function we(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t].value);return n}function E(e,n){for(var t=n.slice(0),r=[],o=e,i=void 0;0<t.length;){for(i=[];0<o;){var a=t.shift();if(!a)break;(o-=ge(JSON.stringify(a)).length)<0&&0<i.length?t.unshift(a):i.push(a)}o=e,r.push(i)}return r}function D(e){var n=e.version||"2.10.2";return e.userAgent+"/"+n}function R(e){return{"X-LaunchDarkly-User-Agent":D(e)}}function be(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce(function(e,n){return y({},e,n)},{})}function ke(e){if(!e)return e;var n=void 0;for(var t in w){var r=w[t],o=e[r];void 0!==o&&"string"!=typeof o&&((n=n||Object.assign({},e))[r]=String(o))}return n||e}var U=2e3;function O(i,a,e,o){var u=a+"/events/bulk/"+e,s=a+"/a/"+e+".gif",n={};function c(e){(new window.Image).src=e}function l(e,n){var t=o||c,r=JSON.stringify(e);return n?function n(t){var e=be({"Content-Type":"application/json","X-LaunchDarkly-Event-Schema":"3"},R(i));return i.httpRequest("POST",u,e,r).promise.then(function(e){if(e)return 400<=e.status&&P(e.status)&&t?n(!1):function(e){var n={status:e.status},t=e.header("date");if(t){var r=Date.parse(t);r&&(n.serverTime=r)}return n}(e)}).catch(function(){return t?n(!1):Promise.reject()})}(!0).catch(function(){}):(t(s+"?d="+ge(r)),Promise.resolve())}return n.sendEvents=function(e){if(!i.httpRequest)return Promise.resolve();var n=i.httpAllowsPost(),t=void 0;t=n?[e]:E(U-a.length,e);for(var r=[],o=0;o<t.length;o++)r.push(l(t[o],n));return Promise.all(r)},n}function I(e){var n={},s=e.allAttributesPrivate,c=e.privateAttributeNames||[],l={key:!0,custom:!0,anonymous:!0},f={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return n.filterUser=function(e){if(!e)return null;function n(o,i){return Object.keys(o).reduce(function(e,n){var t,r=e;return i(n)&&(l[t=n]||!s&&-1===a.indexOf(t)&&-1===c.indexOf(t)?r[0][n]=o[n]:r[1][n]=!0),r},[{},{}])}var a=e.privateAttributeNames||[],t=n(e,function(e){return f[e]}),r=t[0],o=t[1];if(e.custom){var i=n(e.custom,function(){return 1});r.custom=i[0],o=be({},o,i[1])}var u=Object.keys(o);return u.length&&(u.sort(),r.privateAttrs=u),r},n}var Ee=function(){return"LaunchDarkly client initialized"},N=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",Se=function(){return"Be sure to call `identify` in the LaunchDarkly client: http://docs.launchdarkly.com/docs/running-an-ab-test#include-the-client-side-snippet"},Pe=function(){return"localStorage is unavailable"},T=function(){return"localStorage is unavailable, so anonymous user ID cannot be cached"},L=function(e){return"network error"+(e?" ("+e+")":"")},De=function(e){return'Custom event "'+e+'" does not exist'},j=function(){return"environment not found."+N},Re=function(){return"No environment specified."+N},Ue=function(e){return"Error fetching flag settings: "+(e.message||e)},x=function(){return"No user specified."+N},F=function(){return"Invalid user specified."+N},Oe=function(){return"LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."+N},Ie=function(){return"LaunchDarkly bootstrap data is not available because the back end could not read the flags."},A=function(e,n){return'[LaunchDarkly] "'+e+'" is deprecated, please use "'+n+'"'},C=function(e,n,t){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+n+" - "+(P(e)?t:"giving up permanently")},q=function(){return"Cannot make HTTP requests in this environment."+N},Ne=function(){return"identify() has no effect here; it must be called on the main client instance"},J=function(e){return"polling for feature flags at "+e},Te=function(){return"received ping message from stream"},Le=function(){return"received streaming update for all flags"},je=function(e){return'received streaming update for flag "'+e+'"'},xe=function(e){return'received streaming update for flag "'+e+'" but ignored due to version check'},Fe=function(e){return'received streaming deletion for flag "'+e+'"'},Ae=function(e){return'received streaming deletion for flag "'+e+'" but ignored due to version check'},Ce=function(e){return'enqueueing "'+e+'" event'},z=function(e){return"sending "+e+" events"},M=Object.freeze({clientInitialized:Ee,clientNotReady:function(){return"LaunchDarkly client is not ready"},eventWithoutUser:Se,invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:Pe,localStorageUnavailableForUserId:T,networkError:L,unknownCustomEventKey:De,environmentNotFound:j,environmentNotSpecified:Re,errorFetchingFlags:Ue,userNotSpecified:x,invalidUser:F,bootstrapOldFormat:Oe,bootstrapInvalid:Ie,deprecated:A,httpErrorMessage:C,httpUnavailable:q,identifyDisabled:Ne,debugPolling:J,debugStreamPing:Te,debugStreamPut:Le,debugStreamPatch:je,debugStreamPatchIgnored:xe,debugStreamDelete:Fe,debugStreamDeleteIgnored:Ae,debugEnqueueingEvent:Ce,debugPostingEvents:z});function qe(e,n,t,r,o,i){var a,u,s,c,l=4<arguments.length&&void 0!==o?o:null,f={},v=(5<arguments.length&&void 0!==i?i:null)||O(e,n.eventsUrl,t),d=(s=u=0,c={},(a={}).summarizeEvent=function(e){if("feature"===e.kind){var n=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),t=c[n];t?t.count=t.count+1:c[n]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===u||e.creationDate<u)&&(u=e.creationDate),e.creationDate>s&&(s=e.creationDate)}},a.getSummary=function(){var e={},n=!0;for(var t in c){var r=c[t],o=e[r.key];o||(o={default:r.default,counters:[]},e[r.key]=o);var i={value:r.value,count:r.count};void 0!==r.variation&&null!==r.variation&&(i.variation=r.variation),r.version?i.version=r.version:i.unknown=!0,o.counters.push(i),n=!1}return n?null:{startDate:u,endDate:s,features:e}},a.clearSummary=function(){s=u=0,c={}},a),g=I(n),m=n.inlineUsersInEvents,p=n.samplingInterval,h=n.flushInterval,y=[],w=0,b=!1,k=void 0;function E(){return 0===p||0===Math.floor(Math.random()*p)}return f.enqueue=function(e){if(!b){var n,t,r,o=!1,i=!1;if(d.summarizeEvent(e),"feature"===e.kind?E()&&(o=!!e.trackEvents,i=!!(n=e).debugEventsUntilDate&&n.debugEventsUntilDate>w&&n.debugEventsUntilDate>(new Date).getTime()):o=E(),o&&y.push((r=be({},t=e),m||"identify"===t.kind?r.user=g.filterUser(t.user):(r.userKey=t.user.key,delete r.user),"feature"===t.kind&&(delete r.trackEvents,delete r.debugEventsUntilDate),r)),i){var a=be({},e,{kind:"debug"});delete a.trackEvents,delete a.debugEventsUntilDate,delete a.variation,y.push(a)}}},f.flush=function(){if(b)return Promise.resolve();var e=y,n=d.getSummary();return d.clearSummary(),n&&(n.kind="summary",e.push(n)),0===e.length?Promise.resolve():(y=[],r.debug(z(e.length)),v.sendEvents(e).then(function(e){e&&(e.serverTime&&(w=e.serverTime),P(e.status)||(b=!0),400<=e.status&&he(function(){l.maybeReportError(new S(C(e.status,"event posting","some events were dropped")))}))}))},f.start=function(){k=setTimeout(function e(){f.flush(),k=setTimeout(e,h)},h)},f.stop=function(){clearTimeout(k)},f}function Je(n){var e={},o={};return e.on=function(e,n,t){o[e]=o[e]||[],o[e]=o[e].concat({handler:n,context:t})},e.off=function(e,n,t){if(o[e])for(var r=0;r<o[e].length;r++)o[e][r].handler===n&&o[e][r].context===t&&(o[e]=o[e].slice(0,r).concat(o[e].slice(r+1)))},e.emit=function(e){if(o[e])for(var n=0;n<o[e].length;n++)o[e][n].handler.apply(o[e][n].context,Array.prototype.slice.call(arguments,1))},e.getEvents=function(){return Object.keys(o)},e.getEventListenerCount=function(e){return o[e]?o[e].length:0},e.maybeReportError=function(e){e&&(o["error"]?this.emit("error",e):(n||console).error(e.message))},e}function ze(t,r,o,i,a){var u={};function s(){var e="",n=i.getUser();return n&&(e=o||b(JSON.stringify(n))),"ld:"+r+":"+e}return u.loadFlags=function(){return t.get(s()).then(function(e){if(null==e)return null;try{var n=JSON.parse(e);if(n){var t=n.$schema;void 0===t||t<1?n=k(n):delete n.$schema}return n}catch(e){return u.clearFlags().then(function(){return Promise.reject(e)})}}).catch(function(e){return a.warn(Pe()),Promise.reject(e)})},u.saveFlags=function(e){var n=be({},e,{$schema:1});return t.set(s(),JSON.stringify(n)).catch(function(e){return a.warn(Pe()),Promise.reject(e)})},u.clearFlags=function(){return t.clear(s()).catch(function(e){return a.warn(Pe()),Promise.reject(e)})},u}var $="application/json";function Me(d,e,a,u){var s=e.baseUrl,c=e.useReport,l=e.evaluationReasons,g=e.sendLDHeaders,n={},m={};function f(e,n){if(!d.httpRequest)return new Promise(function(e,n){n(new de(q()))});var t=n?"REPORT":"GET",r=g?R(d):{};n&&(r["Content-Type"]="application/json");var o,i,a,u,s,c,l=m[e];l||(o=function(){delete m[e]},s=u=a=i=void 0,(c={addPromise:function(n,e){i=n,a&&a(),a=e,n.then(function(e){i===n&&(u(e),o&&o())},function(e){i===n&&(s(e),o&&o())})}}).resultPromise=new Promise(function(e,n){u=e,s=n}),l=c,m[e]=l);var f=d.httpRequest(t,e,r,n),v=f.promise.then(function(e){return 200===e.status&&e.header("content-type")&&0===e.header("content-type").lastIndexOf($)?JSON.parse(e.body):Promise.reject(404===(n=e).status?new fe(j()):new de(Ue(n.statusText||String(n.status))));var n},function(e){return Promise.reject(new de(L(e)))});return l.addPromise(v,function(){f.cancel&&f.cancel()}),l.resultPromise}return n.fetchFlagSettings=function(e,n){var t=void 0,r=void 0,o="",i=void 0;return c?(r=[s,"/sdk/evalx/",a,"/user"].join(""),i=JSON.stringify(e)):(t=ge(JSON.stringify(e)),r=[s,"/sdk/evalx/",a,"/users/",t].join("")),n&&(o="h="+n),l&&(o=o+(o?"&":"")+"withReasons=true"),r=r+(o?"?":"")+o,u.debug(J(r)),f(r,i)},n.fetchGoals=function(){return f([s,"/sdk/goals/",a].join(""),null)},n}for(var H,K=(function(e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var t=new Uint8Array(16);e.exports=function(){return n(t),t}}else{var r=new Array(16);e.exports=function(){for(var e,n=0;n<16;n++)0==(3&n)&&(e=4294967296*Math.random()),r[n]=e>>>((3&n)<<3)&255;return r}}}(H={exports:{}},H.exports),H.exports),_=[],G=0;G<256;++G)_[G]=(G+256).toString(16).substr(1);var V,X,B=function(e,n){var t=n||0;return[_[e[t++]],_[e[t++]],_[e[t++]],_[e[t++]],"-",_[e[t++]],_[e[t++]],"-",_[e[t++]],_[e[t++]],"-",_[e[t++]],_[e[t++]],"-",_[e[t++]],_[e[t++]],_[e[t++]],_[e[t++]],_[e[t++]],_[e[t++]]].join("")},W=0,Q=0;var Y=function(e,n,t){var r=n&&t||0,o=n||[],i=(e=e||{}).node||V,a=void 0!==e.clockseq?e.clockseq:X;if(null==i||null==a){var u=K();null==i&&(i=V=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==a&&(a=X=16383&(u[6]<<8|u[7]))}var s=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:Q+1,l=s-W+(c-Q)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||W<s)&&void 0===e.nsecs&&(c=0),1e4<=c)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");W=s,X=a;var f=(1e4*(268435455&(s+=122192928e5))+(Q=c))%4294967296;o[r++]=f>>>24&255,o[r++]=f>>>16&255,o[r++]=f>>>8&255,o[r++]=255&f;var v=s/4294967296*1e4&268435455;o[r++]=v>>>8&255,o[r++]=255&v,o[r++]=v>>>24&15|16,o[r++]=v>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var d=0;d<6;++d)o[r+d]=i[d];return n||B(o)},Z="ld:$anonUserId";function $e(o,i){var e={};return e.validateUser=function(e){if(!e)return Promise.reject(new a(x()));var r=me(e);return null!==r.key&&void 0!==r.key?(r.key=r.key.toString(),Promise.resolve(r)):r.anonymous?(o?o.get(Z).catch(function(){return null}):Promise.resolve(null)).then(function(e){if(e)return r.key=e,r;var n,t=Y();return r.key=t,(n=t,o?o.set(Z,n).catch(function(){i.warn(T())}):Promise.resolve()).then(function(){return r})}):Promise.reject(new a(F()))},e}function He(e,n,t,r){var o=be({},{baseUrl:"https://app.launchdarkly.com",streamUrl:"https://clientstream.launchdarkly.com",eventsUrl:"https://events.launchdarkly.com",sendEvents:!0,sendLDHeaders:!0,inlineUsersInEvents:!1,allowFrequentDuplicateEvents:!1,sendEventsOnlyForVariation:!1,useReport:!1,evaluationReasons:!1,flushInterval:2e3,samplingInterval:0,streamReconnectDelay:1e3,allAttributesPrivate:!1,privateAttributeNames:[]},t),i={all_attributes_private:"allAttributesPrivate",private_attribute_names:"privateAttributeNames"};function a(e){he(function(){n&&n.maybeReportError(new f(e))})}var u,s,c,l=be({},e||{});return u=l,Object.keys(i).forEach(function(e){if(void 0!==u[e]){var n=i[e];r.warn(A(e,n)),void 0===u[n]&&(u[n]=u[e]),delete u[e]}}),s=o,c=be({},l),Object.keys(s).forEach(function(e){void 0!==c[e]&&null!==c[e]||(c[e]=s[e])}),l=c,(isNaN(l.flushInterval)||l.flushInterval<2e3)&&(l.flushInterval=2e3,a("Invalid flush interval configured. Must be an integer >= 2000 (milliseconds).")),(isNaN(l.samplingInterval)||l.samplingInterval<0)&&(l.samplingInterval=0,a("Invalid sampling interval configured. Sampling interval must be an integer >= 0.")),l}function Ke(e){var r=0;e&&(r="none"===e?100:["debug","info","warn","error"].indexOf(e));var n={};function t(e,n,t){r<=e&&n(t)}return n.debug=function(e){return t(0,console.log,e)},n.info=function(e){return t(1,console.info,e)},n.warn=function(e){return t(2,console.warn,e)},n.error=function(e){return t(3,console.error,e)},n}var _e="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},Ge="ready",Ve="initialized",Xe="failed",Be="change",We="internal-change";function ee(e,n,t,r,o){var i,a,u,s,c,l,f,v,d,g,m,p,h,y,w=function(){if(t&&t.logger)return t.logger;return o&&o.logger||Ke("warn")}(),b=Je(w),k=He(t,b,o,w),E=k.hash,S=k.sendEvents,P=e,D=(i=r,u=P,s=E,c=(a=k).streamUrl,l={},f=c+"/eval/"+u,v=a.useReport,d=a.evaluationReasons,g=a.streamReconnectDelay,y=h=p=m=null,l.connect=function(e,n){h=e,y=n,U()},l.disconnect=function(){clearTimeout(p),p=null,I()},l.isConnected=function(){return m&&i.eventSourceIsActive&&i.eventSourceIsActive(m)},l);function R(){I(),U(g)}function U(e){p||(e?p=setTimeout(O,e):O())}function O(){var e=void 0,n="",t={};if(i.eventSourceFactory){for(var r in null!=s&&(n="h="+s),v?i.eventSourceAllowsReport?(e=f,t.method="REPORT",t.headers={"Content-Type":"application/json"},t.body=JSON.stringify(h)):(e=c+"/ping/"+u,n=""):e=f+"/"+ge(JSON.stringify(h)),d&&(n=n+(n?"&":"")+"withReasons=true"),e=e+(n?"?":"")+n,I(),m=i.eventSourceFactory(e,t),y)y.hasOwnProperty(r)&&m.addEventListener(r,y[r]);m.onerror=R}}function I(){m&&(m.close(),m=null)}var N,T,L,j,x=k.eventProcessor||qe(r,k,P,w,b),F=Me(r,k,P,w),A={},C={},q=void 0,J=void 0,z=k.streaming,M=void 0,$=!1,H=!1,K=!0,_=k.stateProvider,G=(N=null,T=function(e){if(_)return;e&&B({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})},j=void 0,(L={}).setUser=function(e){(j=ke(e))&&T&&T(me(j))},L.getUser=function(){return j?me(j):null},N&&L.setUser(N),L),V=$e(r.localStorage,w),X=void 0;function B(e){P&&(_&&_.enqueueEvent&&_.enqueueEvent(e)||(e.user?(K=!1,!S||H||r.isDoNotTrack()||(w.debug(Ce(e.kind)),x.enqueue(e))):K&&(w.warn(Se()),K=!1)))}function W(e,n,t){var r=G.getUser(),o=new Date,i=n?n.value:null;if(!k.allowFrequentDuplicateEvents){var a=JSON.stringify(i)+(r&&r.key?r.key:"")+e,u=A[a];if(u&&o-u<3e5)return;A[a]=o}var s={kind:"feature",key:e,user:r,value:i,variation:n?n.variationIndex:null,default:t,creationDate:o.getTime(),reason:n?n.reason:null},c=C[e];c&&(s.version=c.flagVersion?c.flagVersion:c.version,s.trackEvents=c.trackEvents,s.debugEventsUntilDate=c.debugEventsUntilDate),B(s)}function Q(e,n,t){var r=void 0;if(C&&C.hasOwnProperty(e)&&C[e]&&!C[e].deleted){var o=C[e];r=Y(o),null!==o.value&&void 0!==o.value||(r.value=n)}else r={value:n,variationIndex:null,reason:{kind:"ERROR",errorKind:"FLAG_NOT_FOUND"}};return t&&W(e,r,n),r}function Y(e){return{value:e.value,variationIndex:void 0===e.variation?null:e.variation,reason:e.reason||null}}function Z(){J=!0,G.getUser()&&D.connect(G.getUser(),{ping:function(){w.debug(Te()),F.fetchFlagSettings(G.getUser(),E,function(e,n){e&&b.maybeReportError(new de(Ue(e))),ne(n)})},put:function(e){var n=JSON.parse(e.data);w.debug(Le()),ne(n)},patch:function(e){var n=JSON.parse(e.data),t=C[n.key];if(!t||!t.version||!n.version||t.version<n.version){w.debug(je(n.key));var r={},o=be({},n);delete o.key;var i=Y(C[n.key]=o);r[n.key]=t?{previous:t.value,current:i}:{current:i},te(r)}else w.debug(xe(n.key))},delete:function(e){var n=JSON.parse(e.data);if(!C[n.key]||C[n.key].version<n.version){w.debug(Fe(n.key));var t={};C[n.key]&&!C[n.key].deleted&&(t[n.key]={previous:C[n.key].value}),C[n.key]={version:n.version,deleted:!0},te(t)}else w.debug(Ae(n.key))}})}function ee(){J&&(D.disconnect(),J=!1)}function ne(e){var n={};if(!e)return Promise.resolve();for(var t in C)C.hasOwnProperty(t)&&C[t]&&(e[t]&&!pe(e[t].value,C[t].value)?n[t]={previous:C[t].value,current:Y(e[t])}:e[t]&&!e[t].deleted||(n[t]={previous:C[t].value}));for(var r in e)e.hasOwnProperty(r)&&e[r]&&(!C[r]||C[r].deleted)&&(n[r]={current:Y(e[r])});return C=e,te(n).catch(function(){})}function te(o){var e=Object.keys(o);if(0<e.length){var i={};e.forEach(function(e){var n=o[e].current,t=n?n.value:void 0,r=o[e].previous;b.emit(Be+":"+e,t,r),i[e]=n?{current:t,previous:r}:{previous:r}}),b.emit(Be,i),b.emit(We,C),k.sendEventsOnlyForVariation||_||e.forEach(function(e){W(e,o[e].current)})}return q&&X?X.saveFlags(C).catch(function(){return null}):Promise.resolve()}function re(){var e=z||M&&void 0===z;e&&!J?Z():!e&&J&&ee()}function oe(e){return e===Be||e.substr(0,Be.length+1)===Be+":"}r.localStorage&&(X=new ze(r.localStorage,P,E,G,w));var ie=new Promise(function(e){var n=b.on(Ge,function(){b.off(Ge,n),e()})}),ae=new Promise(function(e,n){var t=b.on(Ve,function(){b.off(Ve,t),e()}),r=b.on(Xe,function(e){b.off(Xe,r),n(e)})});if("string"==typeof k.bootstrap&&"LOCALSTORAGE"===k.bootstrap.toUpperCase()&&(X?q=!0:w.warn(Pe())),_){var ue=_.getInitialState();ue?se(ue):_.on("init",se),_.on("update",function(e){e.user&&G.setUser(e.user);e.flags&&ne(e.flags)})}else(e?V.validateUser(n).then(function(e){return G.setUser(e),"object"===_e(k.bootstrap)?(C=function(t){var e=Object.keys(t),r="$flagsState",o=t[r];!o&&e.length&&w.warn(Oe()),!1===t.$valid&&w.warn(Ie());var i={};return e.forEach(function(e){if(e!==r&&"$valid"!==e){var n={value:t[e]};o&&o[e]?n=be(n,o[e]):n.version=0,i[e]=n}}),i}(k.bootstrap),ce()):q?X.loadFlags().catch(function(){return null}).then(function(e){return null==e?(C={},F.fetchFlagSettings(G.getUser(),E).then(function(e){return ne(e||{})}).then(ce).catch(function(e){le(new de(Ue(e)))})):(C=e,he(ce),F.fetchFlagSettings(G.getUser(),E).then(function(e){return ne(e)}).catch(function(e){return b.maybeReportError(e)}))}):F.fetchFlagSettings(G.getUser(),E).then(function(e){C=e||{},ce()}).catch(function(e){C={},le(e)})}):Promise.reject(new fe(Re()))).catch(function(e){return b.maybeReportError(e)});function se(e){P=e.environment,G.setUser(e.user),C=e.flags,he(ce)}function ce(){w.info(Ee()),$=!0,re(),b.emit(Ge),b.emit(Ve)}function le(e){b.maybeReportError(e),b.emit(Xe,e),b.emit(Ge)}return{client:{waitForInitialization:function(){return ae},waitUntilReady:function(){return ie},identify:function(e,n,t){return H?ye(Promise.resolve({}),t):_?(w.warn(Ne()),ye(Promise.resolve(we(C)),t)):ye((q&&X?X.clearFlags():Promise.resolve()).then(function(){return V.validateUser(e)}).then(function(e){return G.setUser(e)}).then(function(){return F.fetchFlagSettings(G.getUser(),n)}).then(function(e){var n=we(e);return e?ne(e).then(function(){return n}):n}).then(function(e){return J&&Z(),e}).catch(function(e){return b.maybeReportError(e),Promise.reject(e)}),t)},getUser:function(){return G.getUser()},variation:function(e,n){return Q(e,n,!0).value},variationDetail:function(e,n){return Q(e,n,!0)},track:function(e,n){"string"==typeof e?(r.customEventFilter&&!r.customEventFilter(e)&&w.warn(De(e)),B({kind:"custom",key:e,data:n,user:G.getUser(),url:r.getCurrentUrl(),creationDate:(new Date).getTime()})):b.maybeReportError(new ve(De(e)))},on:function(e,n,t){oe(e)?(M=!0,$&&re(),b.on(e,n,t)):b.on.apply(b,arguments)},off:function(e){if(b.off.apply(b,arguments),oe(e)){var n=!1;b.getEvents().forEach(function(e){oe(e)&&0<b.getEventListenerCount(e)&&(n=!0)}),n||(M=!1,J&&void 0===z&&ee())}},setStreaming:function(e){var n=null===e?void 0:e;n!==z&&(z=n,re())},flush:function(e){return ye(S?x.flush():Promise.resolve(),e)},allFlags:function(){var e={};if(!C)return e;for(var n in C)C.hasOwnProperty(n)&&(e[n]=Q(n,null,!k.sendEventsOnlyForVariation).value);return e},close:function(e){if(H)return ye(Promise.resolve(),e);function n(){H=!0,C={}}return ye(Promise.resolve().then(function(){if(ee(),S)return x.stop(),x.flush()}).then(n).catch(n),e)}},options:k,emitter:b,ident:G,logger:w,requestor:F,start:function(){S&&x.start()},enqueueEvent:B,getFlagsInternal:function(){return C},internalChangeEventName:We}}var ne={promise:Promise.resolve({status:200,header:function(){return null},body:null})};function te(e,n,t,r,o){if(o&&!function(){var e=window.navigator&&window.navigator.userAgent;if(e){var n=e.match(/Chrom(e|ium)\/([0-9]+)\./);if(n)return parseInt(n[2],10)<73}return 1}())return ne;var i=new window.XMLHttpRequest;for(var a in i.open(e,n,!o),t||{})t.hasOwnProperty(a)&&i.setRequestHeader(a,t[a]);if(o)return i.send(r),ne;var u=void 0;return{promise:new Promise(function(e,n){i.addEventListener("load",function(){u||e({status:i.status,header:function(e){return i.getResponseHeader(e)},body:i.responseText})}),i.addEventListener("error",function(){u||n(new Error)}),i.send(r)}),cancel:function(){u=!0,i.abort()}}}var re=/[|\\{}()[\]^$+*?.]/g,oe=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(re,"\\$&")};function ie(e,n,t,r){var o=n.replace(t,"").replace(r,""),i=void 0,a=void 0;switch(e.kind){case"exact":a=n,i=new RegExp("^"+oe(e.url)+"/?$");break;case"canonical":a=o,i=new RegExp("^"+oe(e.url)+"/?$");break;case"substring":a=o,i=new RegExp(".*"+oe(e.substring)+".*$");break;case"regex":a=o,i=new RegExp(e.pattern);break;default:return}return i.test(a)}function ae(e,r){for(var n={},t=null,o=[],i=0;i<e.length;i++)for(var a=e[i],u=a.urls||[],s=0;s<u.length;s++)if(ie(u[s],window.location.href,window.location.search,window.location.hash)){"pageview"===a.kind?r("pageview",a):(o.push(a),r("click_pageview",a));break}return 0<o.length&&(t=function(e){for(var n=function(e,n){for(var t=[],r=0;r<n.length;r++)for(var o=e.target,i=n[r],a=i.selector,u=document.querySelectorAll(a);o&&0<u.length;){for(var s=0;s<u.length;s++)o===u[s]&&t.push(i);o=o.parentNode}return t}(e,o),t=0;t<n.length;t++)r("click",n[t])},document.addEventListener("click",t)),n.dispose=function(){document.removeEventListener("click",t)},n}var ue=300;function se(r,n){var t=void 0,o=void 0,e={};function i(){o&&o.dispose(),t&&t.length&&(o=ae(t,a))}function a(e,n){var t={kind:e,key:n.key,data:null,url:window.location.href,user:r.ident.getUser(),creationDate:(new Date).getTime()};return"click"===e&&(t.selector=n.selector),r.enqueueEvent(t)}function u(e,n){var t=window.location.href,r=void 0;function o(){(r=window.location.href)!==t&&(t=r,n())}!function e(n,t){n(),setTimeout(function(){e(n,t)},t)}(o,e),window.history&&window.history.pushState?window.addEventListener("popstate",o):window.addEventListener("hashchange",o)}return e.goalKeyExists=function(e){if(!t)return!0;for(var n=0;n<t.length;n++)if("custom"===t[n].kind&&t[n].key===e)return!0;return!1},r.requestor.fetchGoals().then(function(e){e&&0<e.length&&(o=ae(t=e,a),u(ue,i)),n()}).catch(function(e){r.emitter.maybeReportError(new s.LDUnexpectedResponseError((e&&e.message,e.message))),n()}),e}var ce="goalsReady",le={fetchGoals:!0};function Qe(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=function(){var o={pageIsClosing:!1};window.XMLHttpRequest&&(o.httpRequest=function(e,n,t,r){return te(e,n,t,r,o.pageIsClosing)});var e=void 0;o.httpAllowsPost=function(){return void 0===e&&(e=!!window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest),e},o.getCurrentUrl=function(){return window.location.href},o.isDoNotTrack=function(){var e=void 0;return 1===(e=window.navigator&&void 0!==window.navigator.doNotTrack?window.navigator.doNotTrack:window.navigator&&void 0!==window.navigator.msDoNotTrack?window.navigator.msDoNotTrack:window.doNotTrack)||!0===e||"1"===e||"yes"===e};try{window.localStorage&&(o.localStorage={get:function(n){return new Promise(function(e){e(window.localStorage.getItem(n))})},set:function(n,t){return new Promise(function(e){window.localStorage.setItem(n,t),e()})},clear:function(n){return new Promise(function(e){window.localStorage.removeItem(n),e()})}})}catch(e){o.localStorage=null}if(window.EventSource){o.eventSourceFactory=function(e){var n={heartbeatTimeout:3e5,silentTimeout:3e5};return new window.EventSource(e,n)},o.eventSourceIsActive=function(e){return e.readyState===window.EventSource.OPEN||e.readyState===window.EventSource.CONNECTING}}return o.eventSourceAllowsReport=!1,o.userAgent="JSClient",o}(),o=ee(e,n,t,r,le),i=o.client,a=o.options,u=o.emitter,s=new Promise(function(e){var n=u.on(ce,function(){u.off(ce,n),e()})});if(i.waitUntilGoalsReady=function(){return s},a.fetchGoals){var c=se(o,function(){return u.emit(ce)});r.customEventFilter=c.goalKeyExists}else u.emit(ce);return"complete"!==document.readyState?window.addEventListener("load",o.start):o.start(),window.addEventListener("beforeunload",function(){r.pageIsClosing=!0,i.close()}),i}var Ye=Ke;var Ze={initialize:function(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return console&&console.warn&&console.warn(M.deprecated("default export","named LDClient export")),Qe(e,n,t)},version:"2.10.2"};e.initialize=Qe,e.createConsoleLogger=Ye,e.version="2.10.2",e.default=Ze,Object.defineProperty(e,"__esModule",{value:!0})});